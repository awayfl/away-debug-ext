{"version":3,"sources":["js/content.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQA,IAAG,CAAC,MAAM,CAAC,iBAAX,EAA8B;AAC7B,EAAA,OAAO,CAAC,GAAR,CAAY,qBAAZ;AACA,EAAA,IAAI;AACJ;;AAED,SAAS,IAAT,GAAa;AACZ,EAAA,MAAM,CAAC,iBAAP,GAA2B,IAA3B;AAEA,MAAI,UAAU,GAAG,SAAjB,CAHY,CAKZ;;AACA,WAAS,UAAT,CAAoB;AAAC,IAAA;AAAD,GAApB,EAA0B;AACzB;AAEA,QAAI,IAAI,CAAC,IAAL,KAAc,kBAAlB,EAAsC;AACrC;AACA;;AAED,QAAG,CAAC,UAAJ,EAAgB;AACf;AACA;;AAED,IAAA,UAAU,CAAC,WAAX,CAAuB,IAAvB;AACA,GAlBW,CAqBZ;;;AACA,WAAS,WAAT,CAAqB,IAArB,EAAyB;AACxB;AAEA,IAAA,IAAI,CAAC,IAAL,GAAY,iBAAZ;AACA,IAAA,MAAM,CAAC,WAAP,CAAmB,IAAnB,EAAyB,GAAzB;AACA;;AAED,EAAA,MAAM,CAAC,gBAAP,CAAwB,SAAxB,EAAmC,UAAnC;AACA,EAAA,MAAM,CAAC,gBAAP,CAAwB,cAAxB,EAAwC,MAAI;AAC3C,QAAG,UAAH,EAAe;AACd,MAAA,OAAO,CAAC,KAAR,CAAc,eAAd;AACA,MAAA,UAAU,CAAC,WAAX,CAAuB;AAAC,QAAA,IAAI,EAAC;AAAN,OAAvB;AACA;AACD,GALD;AAOA,EAAA,MAAM,CAAC,OAAP,CAAe,SAAf,CAAyB,WAAzB,CAAqC,UAAU,IAAV,EAAmC;AACvE;AACA,IAAA,UAAU,GAAG,IAAb,CAFuE,CAIvE;;AACA,IAAA,IAAI,CAAC,SAAL,CAAe,WAAf,CAA2B,WAA3B;AACA,IAAA,IAAI,CAAC,YAAL,CAAkB,WAAlB,CAA8B,MAAI;AACjC;AAEA,MAAA,IAAI,CAAC,SAAL,CAAe,cAAf,CAA8B,WAA9B;AACA,KAJD;AAKA,GAXD;AAaA,QAAM,SAAS,GAAG,QAAQ,CAAC,aAAT,CAAuB,QAAvB,CAAlB;AAEA,EAAA,SAAS,CAAC,GAAV,GAAgB,MAAM,CAAC,SAAP,CAAiB,MAAjB,CAAwB,gBAAxB,CAAhB;AACA,GAAC,QAAQ,CAAC,IAAT,IAAiB,QAAQ,CAAC,eAA3B,EAA4C,WAA5C,CAAwD,SAAxD;;AAEA,EAAA,SAAS,CAAC,MAAV,GAAmB,YAAA;AAClB,IAAA,SAAS,CAAC,MAAV;AACA,GAFD;AAGA","file":"content.js","sourceRoot":"..\\src","sourcesContent":["export {};\r\n\r\ndeclare global {\r\n\tinterface Window {\r\n\t\t__AWAY__PAGE__API: boolean;\r\n\t}\r\n}\r\n\r\nif(!window.__AWAY__PAGE__API) {\r\n\tconsole.log(\"Init content script\");\r\n\tInit();\r\n}\r\n\r\nfunction Init() {\t\r\n\twindow.__AWAY__PAGE__API = true;\r\n\t\r\n\tlet actualPort = undefined;\r\n\r\n\t// page-api -> devtools\r\n\tfunction _onMessage({data}) {\r\n\t\t// console.log(\"PROXY FROM PAGE TO DEVTOOL\", data);\r\n\r\n\t\tif (data.from !== \"_AWAY_PAGE_event\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(!actualPort) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tactualPort.postMessage(data);\r\n\t}\r\n\r\n\t\r\n\t// devtools -> page-api\r\n\tfunction _postMesage(data) {\r\n\t\t// console.debug(\"Proxy to PAGE\", data);\r\n\r\n\t\tdata.from = \"_AWAY_API_event\";\r\n\t\twindow.postMessage(data, \"*\");\r\n\t}\r\n\r\n\twindow.addEventListener(\"message\", _onMessage);\r\n\twindow.addEventListener(\"beforeunload\", ()=>{\r\n\t\tif(actualPort) {\r\n\t\t\tconsole.debug(\"Page reloaded\");\r\n\t\t\tactualPort.postMessage({type:'unload'});\r\n\t\t}\r\n\t});\r\n\r\n\tchrome.runtime.onConnect.addListener(function (port: chrome.runtime.Port) {\r\n\t\t//console.log(\"AWAY CONTENT\", port);\r\n\t\tactualPort = port;\r\n\r\n\t\t// background -> page-api\r\n\t\tport.onMessage.addListener(_postMesage);\r\n\t\tport.onDisconnect.addListener(()=>{\r\n\t\t\t//console.log(\"DEVTOOL DISCONNECTED\");\r\n\t\t\r\n\t\t\tport.onMessage.removeListener(_postMesage);\r\n\t\t})\r\n\t});\r\n\r\n\tconst injection = document.createElement(\"script\");\r\n\r\n\tinjection.src = chrome.extension.getURL(\"js/page-api.js\");\r\n\t(document.head || document.documentElement).appendChild(injection);\r\n\r\n\tinjection.onload = function () {\r\n\t\tinjection.remove();\r\n\t};\r\n}"]}