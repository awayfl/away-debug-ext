{"version":3,"sources":["js/content.ts"],"names":[],"mappings":";AAuEC,aA1DD,SAAS,IACR,OAAO,mBAAoB,EAEvB,IAAA,OAAa,EAmBR,SAAA,EAAY,GAGpB,EAAK,KAAO,kBACZ,OAAO,YAAY,EAAM,KAG1B,OAAO,iBAAiB,UAvBf,UAAW,KAAC,IAGF,qBAAd,EAAK,MAIL,GAIJ,EAAW,YAAY,KAaxB,OAAO,iBAAiB,eAAgB,KACpC,IACF,QAAQ,MAAM,iBACd,EAAW,YAAY,CAAC,KAAK,cAI/B,OAAO,QAAQ,UAAU,YAAY,SAAU,GAE9C,EAAa,EAGb,EAAK,UAAU,YAAY,GAC3B,EAAK,aAAa,YAAY,KAG7B,EAAK,UAAU,eAAe,OAI1B,MAAA,EAAY,SAAS,cAAc,UAEzC,EAAU,IAAM,OAAO,UAAU,OAAO,mBACvC,SAAS,MAAQ,SAAS,iBAAiB,YAAY,GAExD,EAAU,OAAS,WAClB,EAAU,UAEX,OAAA,eAAA,QAAA,aAAA,CAAA,OAAA,IA/DG,OAAO,oBACV,QAAQ,IAAI,uBACZ","file":"content.js","sourceRoot":"..\\src","sourcesContent":["export {};\r\n\r\ndeclare global {\r\n\tinterface Window {\r\n\t\t__AWAY__PAGE__API: boolean;\r\n\t}\r\n}\r\n\r\nif(!window.__AWAY__PAGE__API) {\r\n\tconsole.log(\"Init content script\");\r\n\tInit();\r\n}\r\n\r\nfunction Init() {\t\r\n\twindow.__AWAY__PAGE__API = true;\r\n\t\r\n\tlet actualPort = undefined;\r\n\r\n\t// page-api -> devtools\r\n\tfunction _onMessage({data}) {\r\n\t\t// console.log(\"PROXY FROM PAGE TO DEVTOOL\", data);\r\n\r\n\t\tif (data.from !== \"_AWAY_PAGE_event\") {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif(!actualPort) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tactualPort.postMessage(data);\r\n\t}\r\n\r\n\t\r\n\t// devtools -> page-api\r\n\tfunction _postMesage(data) {\r\n\t\t// console.debug(\"Proxy to PAGE\", data);\r\n\r\n\t\tdata.from = \"_AWAY_API_event\";\r\n\t\twindow.postMessage(data, \"*\");\r\n\t}\r\n\r\n\twindow.addEventListener(\"message\", _onMessage);\r\n\twindow.addEventListener(\"beforeunload\", ()=>{\r\n\t\tif(actualPort) {\r\n\t\t\tconsole.debug(\"Page reloaded\");\r\n\t\t\tactualPort.postMessage({type:'unload'});\r\n\t\t}\r\n\t});\r\n\r\n\tchrome.runtime.onConnect.addListener(function (port: chrome.runtime.Port) {\r\n\t\t//console.log(\"AWAY CONTENT\", port);\r\n\t\tactualPort = port;\r\n\r\n\t\t// background -> page-api\r\n\t\tport.onMessage.addListener(_postMesage);\r\n\t\tport.onDisconnect.addListener(()=>{\r\n\t\t\t//console.log(\"DEVTOOL DISCONNECTED\");\r\n\t\t\r\n\t\t\tport.onMessage.removeListener(_postMesage);\r\n\t\t})\r\n\t});\r\n\r\n\tconst injection = document.createElement(\"script\");\r\n\r\n\tinjection.src = chrome.extension.getURL(\"js/page-api.js\");\r\n\t(document.head || document.documentElement).appendChild(injection);\r\n\r\n\tinjection.onload = function () {\r\n\t\tinjection.remove();\r\n\t};\r\n}"]}