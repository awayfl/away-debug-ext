{"version":3,"sources":["js/lib/API.ts","js/lib/EVENT.ts","js/devtools.ts"],"names":[],"mappings":"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","file":"devtools.8279e2d4.js","sourceRoot":"..\\src","sourcesContent":["export const PAGES = {\r\n\tCONTENT: \"content-page\",\r\n\tDEVTOOL: \"devtools-page\",\r\n};\r\n\r\nexport interface IMessage {\r\n\ttarget: string;\r\n\tsender: string;\r\n\ttype: string;\r\n\terror: any;\r\n\tid: number;\r\n\tanswer?: (data: any) => void;\r\n}\r\n\r\nexport class APIServer {\r\n\tprotected _bus: chrome.runtime.Port = undefined;\r\n\tprotected _pool: {[key: string]: any} = {};\r\n\tprotected _flow: {[key: string]: (mess: IMessage) => void} = {};\r\n\tprotected _messageID: number = 0;\r\n\r\n\tconstructor(public name = '') {\r\n\t\tthis._onMessage = this._onMessage.bind(this);\r\n\t}\r\n\t\r\n\tconnect(tabId = undefined) {\r\n\t\tif (this._bus) {\r\n\t\t\tthis._bus.disconnect();\r\n\t\t}\r\n\r\n\t\tif (!tabId) {\r\n\t\t\tthis._bus = chrome.runtime.connect({ name: this.name});\r\n\t\t} else {\r\n\t\t\tthis._bus = chrome.tabs.connect(tabId, { name: this.name });\r\n\t\t}\r\n\r\n\t\tthis._bus.onMessage.addListener(this._onMessage.bind(this));\r\n\t}\r\n\r\n\tclose() {\r\n\t\tthis._bus && this._bus.disconnect();\r\n\t\tthis._bus = undefined;\r\n\t}\r\n\r\n\tget opened() {\r\n\t\treturn !!this._bus;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {IMessage} data\r\n\t * @returns {{answer: Function}}\r\n\t */\r\n\t_answerFlow(data: IMessage) {\r\n\t\tdata.answer = (_newData = {}) => {\r\n\t\t\t_newData.type = data.type;\r\n\t\t\t_newData.id = data.id;\r\n\t\t\t_newData.target = data.sender;\r\n\t\t\tthis._bus.postMessage(_newData);\r\n\t\t};\r\n\t\treturn data;\r\n\t}\r\n\r\n\t_onMessage(data: IMessage) {\r\n\r\n\t\t// console.debug(\"API\", this.name, data);\r\n\r\n\t\tconst resolver = data.id !== undefined ? this._pool[data.id] : undefined;\r\n\r\n\t\tif (!resolver) {\r\n\t\t\tif (this._flow[data.type]) {\r\n\t\t\t\tthis._flow[data.type](this._answerFlow(data));\r\n\r\n\t\t\t\t// console.debug(\"CAll flow\", data.type);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn(\"message resolve not found\", data.id, data.type);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._pool[data.id] = undefined;\r\n\t\t\tif (data.error) {\r\n\t\t\t\tresolver.reject(data.error);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tresolver.resolve(data);\r\n\t\t}\r\n\t}\r\n\r\n\tonFlow(type: string, callback: (data: IMessage & any) => void) {\r\n\t\tthis._flow[type] = callback;\r\n\t}\r\n\r\n\toffFlow(type: string) {\r\n\t\tthis._flow[type] = undefined;\r\n\t}\r\n\r\n\r\n\tasync send(type: string, data: any, timeout = 0): Promise<IMessage & any> {\r\n\t\tif (!this._bus) {\r\n\t\t\tthrow new Error(\"Connection not opened!\");\r\n\t\t}\r\n\r\n\t\tdata.type = type;\r\n\t\tdata.id = data.id || this._messageID++;\r\n\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis._pool[data.id] = {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\tresolve,\r\n\t\t\t\treject,\r\n\t\t\t};\r\n\r\n\t\t\tif(timeout > 0) {\r\n\t\t\t\tsetTimeout(()=>{\r\n\t\t\t\t\treject(\"API call rejected by timeout\")\r\n\t\t\t\t}, timeout);\r\n\t\t\t}\r\n\r\n\t\t\tthis._bus.postMessage(data);\r\n\t\t});\r\n\t}\r\n}\r\n","export const enum EVENT {\r\n\tINJECT = 'inject',\r\n\tDETACH = 'detach',\r\n\tTEST = 'test',\r\n\tINFO = 'info',\r\n\tLOG_BLOB = 'log',\r\n\tLOG_INIT = 'log-init',\r\n\tLOG_STOP = 'log-stop',\r\n\tCALL = 'call',\r\n\tTRACK_BOUNDS = 'track-bounds'\r\n};\r\n","//@ts-check\r\n\r\nimport { APIServer, PAGES } from \"./lib/API\";\r\nimport { EVENT } from \"./lib/EVENT\";\r\n\r\nconst api = new APIServer(PAGES.DEVTOOL);\r\n\r\nlet contex: IPanelAPI = undefined;\r\nlet isCapture: boolean = false;\r\nlet pingTimeout: any = undefined;\r\nlet isAttached: boolean = false;\r\nlet currentTab: number = -1;\r\n\r\nasync function injectPageApi(): Promise<any> {\r\n\tcurrentTab = chrome.devtools.inspectedWindow.tabId;\r\n\tconsole.log(\"CURRENT TAB\", currentTab);\r\n\r\n\tapi.connect(currentTab);\r\n\r\n\treturn true;\r\n\r\n\t/*\r\n\tconst testPage = await new Promise((res)=>{\r\n\t\tchrome.tabs.executeScript(currentTab, {\r\n\t\t\tcode: `window.__AWAY__PAGE__API`\r\n\t\t}, (result)=>{\r\n\t\t\tconsole.debug(\"Test page of field\", result);\r\n\t\t\t\r\n\t\t\tres(result[0]);\r\n\t\t})\r\n\t})\r\n\r\n\tif(testPage) {\r\n\t\tconsole.debug(\"Connect to existed page\");\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tconsole.debug(\"Execute new instance\");\r\n\r\n\treturn new Promise((res) => {\r\n\t\tchrome.tabs.executeScript(\r\n\t\t\tcurrentTab,\r\n\t\t\t{ file: \"js/content.js\" },\r\n\t\t\tres\r\n\t\t);\r\n\t});*/\r\n}\r\n\r\nasync function getStatus(timeout = 0): Promise<boolean> {\r\n\treturn api.send(EVENT.TEST, {}, timeout).then((e) => {\r\n\t\treturn e.status;\r\n\t});\r\n}\r\n\r\nlet _logsCallback = undefined;\r\n\r\nfunction serverIsDetached() {\r\n\tclearInterval(pingTimeout);\r\n\r\n\tisCapture = false;\r\n\tisAttached = false;\r\n\tcontex && contex.detach(true);\r\n\r\n\tconsole.debug(\"AWAY DEV server is detached!\");\r\n}\r\n\r\nlet runned = false;\r\n\r\nfunction startPingout() {\r\n\tpingTimeout = setTimeout(() => {\r\n\t\tserverIsDetached();\r\n\t}, 1000);\r\n\r\n\tgetStatus().then((status) => {\r\n\t\tclearInterval(pingTimeout);\r\n\r\n\t\tif (!status) {\r\n\t\t\tserverIsDetached();\r\n\t\t} else {\r\n\t\t\tpingTimeout = setTimeout(() => {\r\n\t\t\t\tstartPingout();\r\n\t\t\t}, 1000);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction _onBlobReached(data: { blob: string[]; answer: Function }) {\r\n\tif (_logsCallback) {\r\n\t\t// пинаем, что не зависили!\r\n\t\tdata.answer({});\r\n\t\t_logsCallback(data.blob);\r\n\t}\r\n}\r\n\r\nfunction startCaptureLogs({ type, limit = 500000 }, callback) {\r\n\t_logsCallback = callback;\r\n\r\n\treturn api\r\n\t\t.send(EVENT.LOG_INIT, {\r\n\t\t\tlogType: type,\r\n\t\t\tlimit,\r\n\t\t\ttarget: PAGES.CONTENT,\r\n\t\t})\r\n\t\t.then(({ allow }) => {\r\n\t\t\tif (allow) {\r\n\t\t\t\tconsole.log(\"register blob flow\");\r\n\r\n\t\t\t\tapi.onFlow(EVENT.LOG_STOP, () => stopCaptureLogs(true));\r\n\t\t\t\tapi.onFlow(EVENT.LOG_BLOB, _onBlobReached);\r\n\t\t\t}\r\n\t\t\tisCapture = allow;\r\n\r\n\t\t\treturn allow;\r\n\t\t});\r\n}\r\n\r\nfunction stopCaptureLogs(supress = false) {\r\n\tif (!isCapture) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tisCapture = false;\r\n\r\n\tconsole.debug(\"DEVTOOL\", \"STOP CAPTURE\");\r\n\r\n\tapi.offFlow(EVENT.LOG_BLOB);\r\n\r\n\tif (!supress) {\r\n\t\tapi.send(EVENT.LOG_STOP, { target: PAGES.CONTENT });\r\n\t}\r\n\r\n\tcontex.emit(EVENT.LOG_STOP, {});\r\n\t_logsCallback = undefined;\r\n}\r\n\r\nlet _connection = undefined;\r\n\r\nasync function _tryConnect(): Promise<boolean> {\r\n\tawait injectPageApi();\r\n\r\n\t//if(api.)api.connect(currentTab);\r\n\r\n\ttry {\r\n\t\tisAttached = await getStatus(300);\r\n\t} catch (e) {\r\n\t\tisAttached = false;\r\n\t}\r\n\r\n\tif (isAttached) {\r\n\t\tstartPingout();\r\n\t}\r\n\r\n\t_connection = undefined;\r\n\treturn isAttached;\r\n}\r\n\r\nasync function tryConnect(): Promise<boolean> {\r\n\tif (_connection) {\r\n\t\tconsole.log(\"Called runned connectio\");\r\n\t\treturn _connection;\r\n\t}\r\n\r\n\t_connection = _tryConnect();\r\n\r\n\tsetTimeout(() => {\r\n\t\t_connection = undefined;\r\n\t}, 1000);\r\n\r\n\treturn _connection;\r\n}\r\n\r\nasync function getAppInfo(): Promise<any> {\r\n\treturn directCall(\"getInfo\");\r\n}\r\n\r\nasync function directCall(method: string, args: any[] = []): Promise<any> {\r\n\tconsole.debug(\"CALL DIRECT\", method, args);\r\n\r\n\tif (!isAttached) {\r\n\t\t//try {\r\n\t\t//\tawait tryConnect();\r\n\t\t//} catch {\r\n\t\t\tthrow \"DevTool not attached to page!\";\r\n\t\t//}\r\n\t}\r\n\r\n\treturn api\r\n\t\t.send(EVENT.CALL, { method, args, target: PAGES.CONTENT })\r\n\t\t.then((e) => {\r\n\t\t\tif (e.error) {\r\n\t\t\t\tthrow e.error;\r\n\t\t\t}\r\n\r\n\t\t\treturn e.result;\r\n\t\t});\r\n}\r\n\r\n\r\nasync function trackBounds(method: string, args: any): Promise<any> {\r\n\tconsole.debug(\"CALL TRACK BOUNDS\", method, args);\r\n\r\n\tif (!isAttached) {\r\n\t\t//try {\r\n\t\t//\tawait tryConnect();\r\n\t\t//} catch {\r\n\t\t\tthrow \"DevTool not attached to page!\";\r\n\t\t//}\r\n\t}\r\n\r\n\treturn\tapi.send(EVENT.TRACK_BOUNDS, {method, args, target: PAGES.CONTENT}).then((e) => {\r\n\t\tif (e.error) {\r\n\t\t\tthrow e.error;\r\n\t\t}\r\n\r\n\t\treturn e.result;\r\n\t});\r\n}\r\n\r\nconst devApi: IDevToolAPI = {\r\n\tgetStatus,\r\n\tstartCaptureLogs,\r\n\tstopCaptureLogs,\r\n\ttryConnect,\r\n\tgetAppInfo,\r\n\tdirectCall,\r\n\t//\r\n\ttrackBounds,\r\n};\r\n\r\nfunction _onPanelShow(panelContext: Window) {\r\n\tsetTimeout(() => {\r\n\t\tapi.onFlow(\"unload\", serverIsDetached);\r\n\r\n\t\tcontex = panelContext.PANEL_API;\r\n\t\tcontex.init(devApi);\r\n\t}, 100);\r\n}\r\n\r\nfunction _onPanelHide() {\r\n\tserverIsDetached();\r\n\r\n\tapi.offFlow(\"unload\");\r\n\tapi.close();\r\n\r\n\tcontex = undefined;\r\n}\r\n\r\nchrome.devtools.panels.create(\r\n\t\"AwayFL\",\r\n\t\"gfx/icon16.png\",\r\n\t\"panel.html\",\r\n\t(panel) => {\r\n\t\tpanel.onShown.addListener(_onPanelShow);\r\n\t\tpanel.onHidden.addListener(_onPanelHide);\r\n\t}\r\n);\r\n"]}